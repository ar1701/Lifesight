<nav class="navbar-redesigned">
  <div class="navbar-container">
    <!-- Brand Section -->
    <div class="navbar-brand-section">
      <a href="/app" class="brand-link">
        <div class="brand-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
            <path
              d="M3 13H11V3H3V13ZM3 21H11V15H3V21ZM13 21H21V11H13V21ZM13 3V9H21V3H13Z"
              fill="currentColor"
            />
          </svg>
        </div>
        <div class="brand-text">
          <div class="brand-name">SaleSight</div>
          <div class="brand-tagline">Analytics Platform</div>
        </div>
      </a>
    </div>

    <!-- Progress Indicator -->
    <div class="progress-indicator">
      <div
        class="progress-step <%= typeof currentPage !== 'undefined' && currentPage === 'home' ? 'active' : 'completed' %>"
      >
        <div class="step-number">1</div>
        <div class="step-label">Data</div>
      </div>
      <div class="progress-connector"></div>
      <div
        class="progress-step <%= typeof currentPage !== 'undefined' && currentPage === 'dashboards' ? 'active' : '' %>"
      >
        <div class="step-number">2</div>
        <div class="step-label">Analyze</div>
      </div>
      <div class="progress-connector"></div>
      <div
        class="progress-step <%= typeof currentPage !== 'undefined' && currentPage === 'marketing' ? 'active' : '' %>"
      >
        <div class="step-number">3</div>
        <div class="step-label">Insights</div>
      </div>
    </div>

    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M3 12H21M3 6H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>

    <!-- Navigation Links -->
    <div class="navbar-nav" id="navbarNav">
      <a
        href="/app"
        class="nav-link <%= typeof currentPage !== 'undefined' && currentPage === 'home' ? 'active' : '' %>"
        data-tooltip="Upload and manage your data files"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path
            d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.89 22 5.99 22H18C19.1 22 20 21.1 20 20V8L14 2ZM18 20H6V4H13V9H18V20Z"
            fill="currentColor"
          />
        </svg>
        <span>Data Hub</span>
      </a>

      <a
        href="/app/dashboards"
        class="nav-link <%= typeof currentPage !== 'undefined' && currentPage === 'dashboards' ? 'active' : '' %>"
        data-tooltip="Create and view your dashboards"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path
            d="M3 13H11V3H3V13ZM3 21H11V15H3V21ZM13 21H21V11H13V21ZM13 3V9H21V3H13Z"
            fill="currentColor"
          />
        </svg>
        <span>Dashboards</span>
      </a>

      <a
        href="/app/marketing"
        class="nav-link <%= typeof currentPage !== 'undefined' && currentPage === 'marketing' ? 'active' : '' %>"
        data-tooltip="Advanced marketing analytics"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path
            d="M16 6L18.29 8.29L13.41 13.17L9.41 9.17L2 16.59L3.41 18L9.41 12L13.41 16L19.71 9.71L22 12V6H16Z"
            fill="currentColor"
          />
        </svg>
        <span>Marketing</span>
      </a>
    </div>

    <!-- User Section -->
    <div class="navbar-user-section">
      <div
        class="help-button"
        onclick="toggleHelpPanel()"
        data-tooltip="Get help and tutorials"
      >
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path
            d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 19H11V17H13V19ZM15.07 11.25L14.17 12.17C13.45 12.9 13 13.5 13 15H11V14.5C11 13.4 11.45 12.4 12.17 11.67L13.41 10.41C13.78 10.05 14 9.55 14 9C14 7.9 13.1 7 12 7C10.9 7 10 7.9 10 9H8C8 6.79 9.79 5 12 5C14.21 5 16 6.79 16 9C16 9.88 15.64 10.68 15.07 11.25Z"
            fill="currentColor"
          />
        </svg>
      </div>

      <div class="user-menu" onclick="toggleUserMenu()">
        <div class="user-avatar">
          <%= user.name ? user.name.charAt(0).toUpperCase() : 'U' %>
        </div>
        <div class="user-info">
          <div class="user-name"><%= user.name || 'User' %></div>
          <div class="user-email"><%= user.email %></div>
        </div>
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          class="dropdown-arrow"
        >
          <path d="M7 10L12 15L17 10H7Z" fill="currentColor" />
        </svg>
      </div>

      <!-- User Dropdown -->
      <div class="user-dropdown" id="userDropdown" style="display: none">
        <a href="/profile" class="dropdown-item">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path
              d="M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z"
              fill="currentColor"
            />
          </svg>
          Profile Settings
        </a>
        <a href="/logout" class="dropdown-item logout">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path
              d="M17 7L15.59 8.41L18.17 11H8V13H18.17L15.59 15.59L17 17L22 12L17 7ZM4 5H12V3H4C2.9 3 2 3.9 2 5V19C2 20.1 2.9 21 4 21H12V19H4V5Z"
              fill="currentColor"
            />
          </svg>
          Logout
        </a>
      </div>
    </div>
  </div>

  <!-- Help Panel -->
  <div class="help-panel" id="helpPanel" style="display: none">
    <div class="help-content">
      <h3>Quick Start Guide</h3>
      <div class="help-steps">
        <div class="help-step">
          <div class="step-icon">1</div>
          <div class="step-text">
            <strong>Upload Data</strong><br />
            Start by uploading your CSV or Excel files
          </div>
        </div>
        <div class="help-step">
          <div class="step-icon">2</div>
          <div class="step-text">
            <strong>Generate Insights</strong><br />
            Ask AI to create charts and tables from your data
          </div>
        </div>
        <div class="help-step">
          <div class="step-icon">3</div>
          <div class="step-text">
            <strong>Build Dashboards</strong><br />
            Add your visualizations to organized dashboards
          </div>
        </div>
      </div>
      <div class="help-actions">
        <button class="btn btn-primary btn-sm" onclick="startTour()">
          Take Tour
        </button>
        <button class="btn btn-ghost btn-sm" onclick="toggleHelpPanel()">
          Close
        </button>
      </div>
    </div>
  </div>
</nav>

<script>
  function toggleUserMenu() {
    const dropdown = document.getElementById("userDropdown");
    dropdown.style.display =
      dropdown.style.display === "none" ? "block" : "none";
  }

  function toggleHelpPanel() {
    const panel = document.getElementById("helpPanel");
    panel.style.display = panel.style.display === "none" ? "block" : "none";
  }

  function toggleMobileMenu() {
    const nav = document.getElementById("navbarNav");
    const isOpen = nav.classList.contains("mobile-open");
    
    if (isOpen) {
      nav.classList.remove("mobile-open");
    } else {
      nav.classList.add("mobile-open");
    }
  }

  function startTour() {
    // We'll implement this later
    alert("Interactive tour coming soon!");
  }

  // Close dropdowns when clicking outside
  document.addEventListener("click", (e) => {
    if (!e.target.closest(".user-menu")) {
      document.getElementById("userDropdown").style.display = "none";
    }
    if (!e.target.closest(".help-button") && !e.target.closest(".help-panel")) {
      document.getElementById("helpPanel").style.display = "none";
    }
  });
</script>
